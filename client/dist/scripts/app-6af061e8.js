"use strict";angular.module("BigScreen.AppShared",["ngAnimate","ngSanitize","ui.bootstrap","LocalStorageModule","ui.router","BigScreen.Secure","BigScreen"]).constant("AppConfig",{StoragePrefix:"BigScreen",USER_SESSION:"USER_SESSION"}).config(["localStorageServiceProvider","AppConfig",function(e,t){e.setPrefix(t.StoragePrefix).setStorageType("localStorage").setStorageCookie(30,"/").setNotify(!0,!0)}]),angular.module("BigScreen.AppShared").directive("switchery",["$timeout",function(){return{restrict:"E",scope:{on:"=ngModel",reverse:"=?",ngChange:"&"},templateUrl:"app/components/AppShared/directives/switchery/switchery.template.html",replace:!0,link:function(e,t,r){e.yesText=r.yesText||"On",e.noText=r.noText||"Off",e.switch=function(){r.hasOwnProperty("readonly")||(e.on=!e.on)},e.ngChange&&"function"==typeof e.ngChange&&e.$watch("on",function(t,r){void 0!==t&&void 0!==r&&e.$eval(e.ngChange)})}}}]),angular.module("BigScreen.AppShared").directive("smileyFace",function(){return{restrict:"EA",templateUrl:"app/components/AppShared/directives/smiley-face/smiley-face.html",scope:{level:"="}}}),angular.module("BigScreen.AppShared").directive("appRoom",["RoomSensorService",function(e){return{restrict:"E",templateUrl:"app/components/AppShared/directives/room/room.html",replace:!0,scope:{room:"="},link:function(t){e.run(t.room),t.$on("$destroy",function(){e.stop(t.room)})}}}]),angular.module("BigScreen.AppShared").directive("preloader",function(){return{restrict:"EA",templateUrl:"app/components/AppShared/directives/preloader/preloader.html"}}),angular.module("BigScreen.AppShared").directive("appMeetingRoom",["$interval","ApiService","RoomSensorService",function(e,t,r){return{restrict:"E",templateUrl:"app/components/AppShared/directives/meeting-room/meeting-room.html",replace:!0,scope:{room:"="},link:function(n){function a(e){n.room.bookInfoList&&(n.room.busy=!1,n.room.bookInfoList.forEach(function(t){return e.isBetween(t.startTime,t.endTime)?(n.room.busy=!0,!0):void 0}))}var i=["PIR"];n.bookingMode=!0;var o=e(function(){n.bookingMode=!n.bookingMode},1e4);r.run(n.room,!0),n.room.bookInfoList=[],t.MeetingRoom.get({id:n.room.id,sign:n.room.sign}).$promise.then(function(e){if(e.success){var t,r;e.content.bookInfoList.forEach(function(e){t=moment(e.startTime),r=moment(e.endTime),n.room.bookInfoList.push({startTime:t,endTime:r,start:t.format("H:mm"),end:r.format("H:mm")})}),a(moment())}}),n.hasSchema=function(e){return n.room.things.EnvironmentSensor[0].schema&&!i.includes(e)&&n.room.things.EnvironmentSensor[0].schema.hasOwnProperty(e)},n.getName=function(e){return n.room.things.EnvironmentSensor[0].schema[e].displayNameCN},n.hasWarn=function(e){return n.room.conditions&&n.room.conditions.findIndex(function(t){return t.state===e})>=0},n.$on("theMin",function(e,t){a(t)}),n.$on("$destroy",function(){e.cancel(o),o=void 0,r.stop(n.room)})}}}]),angular.module("BigScreen.Portal",["ngResource","BigScreen.AppShared"]).constant("VIP",{BILL:"0bea9fe760aaa85df7d953d6ab38d2e56692ddd8",Dolf:"a84feeebde4e496389b9161d7d64e565645b759f",oldKim:"a2e3a03c81aa83c5ac451b195d2f8d4b0eb37c97"}).config(["$resourceProvider",function(e){e.defaults.stripTrailingSlashes=!1}]),angular.module("BigScreen.Portal").controller("WelcomeController",["$scope",function(){}]),angular.module("BigScreen.Portal").controller("VIPController",["$scope","$state","$stateParams","$interval","GeofenceService",function(e,t,r,n,a){var i=r.id,o=a.vip;if(!o)return void t.go("^.OfficeSpace");var s=n(function(){a.rotative&&(i===o.pics.length?t.go("^.OfficeSpace"):t.go(".",{name:r.name,id:i+1}))},1e4);e.pic=o.pics[i-1],e.$on("$stateChangeSuccess",function(){e.$parent.portalTitle=e.pic.text}),e.$on("$destroy",function(){angular.isDefined(s)&&(n.cancel(s),s=void 0)})}]),angular.module("BigScreen.Portal").factory("PersonnelService",["$rootScope","$q","ApiService",function(e,t,r){return{identifyFrequency:function(){var e={startDateTime:moment().startOf("day").valueOf(),endDateTime:moment().add(1,"days").startOf("day").valueOf(),interval:"10m"},n=angular.extend({cameraPositions:["south_in","east_in"]},e),a=angular.extend({cameraPositions:["south_out","east_out"]},e),i=r.Personneel.identifyFrequency({},n).$promise,o=r.Personneel.identifyFrequency({},a).$promise,s=t.defer();return t.all([i,o]).then(function(e){var t=[e[0].aggregations.byInterval.buckets,e[1].aggregations.byInterval.buckets];s.resolve(t)},function(){s.reject()}),s.promise},searchByStranger:function(){return r.Personneel.searchByStranger({},{startDateTime:moment().subtract(3,"days").valueOf(),endDateTime:9999999999999,cameraPositions:["south_out","east_out","south_in","east_in"],orderByTimestamp:"desc",size:3,from:0}).$promise},getYesterdayRecord:function(){return r.Personneel.searchLatestRecord({},{startDateTime:moment().subtract(1,"days").startOf("day").valueOf(),endDateTime:moment().subtract(1,"days").endOf("day").valueOf(),cameraPositions:["south_out","east_out","south_in","east_in"]}).$promise},getTodayRecord:function(){return r.Personneel.searchLatestRecord({},{startDateTime:moment().startOf("day").valueOf(),endDateTime:moment().endOf("day").valueOf(),cameraPositions:["south_out","east_out","south_in","east_in"]}).$promise}}}]).factory("PersonnelChart",["$rootScope","$q","PersonnelService",function(e,t,r){function n(e,t){var r=6e5,n=a(e,t),i=Array(n.length).fill(0),o=Array(n.length).fill(0);return e.forEach(function(e){i[n.indexOf(e.key)]=e.doc_count}),t.forEach(function(e){o[n.indexOf(e.key)]=e.doc_count}),n=n.map(function(e){return moment(e+r).format("H:mm")}),{x:n,dataIn:i,dataOut:o,maxIn:_.maxBy(e,"doc_count").key+r,maxOut:_.maxBy(t,"doc_count").key+r}}function a(e,t){var r=_.unionBy(e,t,"key");return r=_.map(r,"key").sort()}var i,o,s="path://M 5.477 69.249 l 89.081 9.082 v 46.07 c 0 5.522 4.477 10 10 10 h 304 c 5.522 0 10 -4.478 10 -10 v -112 c 0 -5.523 -4.478 -10 -10 -10 h -304 c -5.523 0 -10 4.477 -10 10 v 46.07",l={tooltip:{trigger:"axis"},xAxis:{type:"category",boundaryGap:!1,data:[],axisLabel:{textStyle:{fontSize:24}}},yAxis:{type:"value",axisLabel:{textStyle:{fontSize:24},formatter:function(e){return 0!==e?e:void 0}}},series:[{name:"进入",type:"line",smooth:!0,itemStyle:{normal:{opacity:0}},lineStyle:{normal:{width:0}},areaStyle:{normal:{color:"#89a8b9"}},markPoint:{symbol:s,symbolSize:[156,70],symbolOffset:["78",0],itemStyle:{normal:{color:"#ff6600"}},label:{normal:{textStyle:{fontSize:24},position:"insideRight",formatter:function(e){var t=o.x[e.data.coord[0]];return"进入高峰 \n"+e.value+" /"+t+" "}}},data:[{type:"max",name:"最大值"}]}},{name:"离开",type:"line",smooth:!0,itemStyle:{normal:{opacity:0}},lineStyle:{normal:{width:0}},areaStyle:{normal:{color:"#2ec3ed"}},markPoint:{symbol:s,symbolSize:[156,70],symbolOffset:["78",0],itemStyle:{normal:{color:"#2bce10"}},label:{normal:{textStyle:{fontSize:24},position:"insideRight",formatter:function(e){var t=o.x[e.data.coord[0]];return"出去高峰 \n"+e.value+" /"+t+" "}}},data:[{type:"max",name:"最大值"}]}}]},c={init:function(e){i=echarts.init(e),i.setOption(l)},setData:function(){var e=t.defer();return r.identifyFrequency().then(function(t){o=n(t[0],t[1]),i.setOption({xAxis:{data:o.x},series:[{name:"进入",data:o.dataIn},{name:"离开",data:o.dataOut}]}),e.resolve({"in":o.maxIn,out:o.maxOut})}),e.promise}};return c}]),angular.module("BigScreen.Portal").controller("PersonnelController",["$scope","$interval","$timeout","PersonnelService","PersonnelChart",function(e,t,r,n,a){function i(){a.setData().then(function(t){e.max=t})}function o(e){for(var t,r=e.length-1;r>=0;r--)if("non_beehive_user"!==e[r].key){t=e[r].latest_record.hits.hits[0]._source;break}return t}function s(e){for(var t,r=0;r<e.length;r++)if("non_beehive_user"!==e[r].key){t=e[r].latest_record.hits.hits[0]._source;break}return t}function l(e){return e?{name:e.object.subject.name,photo:e.object.photo,time:e.timestamp}:void 0}a.init(document.getElementById("personnel-chart")),i(),e.today=moment().format("YYYY/MM/DD"),e.yesterday=moment().subtract(1,"days").format("YYYY/MM/DD"),e.$on("theMin",i),n.getTodayRecord().then(function(t){var r=o(t.aggregations.beehive_user.buckets,"todayEnter");e.todayEnter=l(r)}),n.getYesterdayRecord().then(function(t){var r=o(t.aggregations.beehive_user.buckets,"todayEnter");e.yesterdayEnter=l(r),r=s(t.aggregations.beehive_user.buckets,"todayEnter"),e.yesterdayLeave=l(r)})}]),angular.module("BigScreen.Portal").factory("ParkingAreaService",["ApiService","$resource","$q",function(e,t,r){var n=e.ParkingArea.getCarInFrequency,a=e.ParkingArea.getCarOutFrequency;return{getCarInOut:function(){var e=moment().startOf("hour").hour(8).valueOf(),t=moment().startOf("hour").hour(20).valueOf(),i=(new Date).valueOf();i>t?i=t:e>i?i=e:i-=i%6e5;var o={startTime:e,endTime:i,interval:"10m"},s=r.defer();return r.all([n(o).$promise,a(o).$promise]).then(function(e){var t=[e[0].aggregations.byHour.buckets,e[1].aggregations.byHour.buckets];s.resolve(t)},function(){s.reject()}),s.promise},leaveAvgTime:function(){return e.ParkingArea.leaveAvgTime({},{startTime:moment().subtract(1,"days").startOf("day").valueOf(),endTime:moment().valueOf()}).$promise}}}]).factory("ParkingChart",["$rootScope","ParkingAreaService",function(e,t){function r(e,t){var r=n(e,t),a=Array(r.length).fill(0),i=Array(r.length).fill(0);return e.forEach(function(e){a[r.indexOf(moment(e.key).add(10,"m").format("H:mm"))]=e.doc_count}),t.forEach(function(e){i[r.indexOf(moment(e.key).add(10,"m").format("H:mm"))]=e.doc_count}),{x:r,dataIn:a,dataOut:i}}function n(e,t){var r=_.unionBy(e,t,"key");return 0===r.length?(s=0,l):(r=_.map(r,"key").sort(),r.map(function(e){return moment(e).add(10,"m").format("H:mm")}))}function a(){d.setOption({xAxis:{data:m.x},series:[{name:"进入高峰",data:m.dataIn,markPoint:{symbolSize:s}},{name:"驶出高峰",data:m.dataOut,markPoint:{symbolSize:s}}]})}for(var i={tooltip:{trigger:"axis"},xAxis:{type:"category",boundaryGap:!1,data:[],axisLabel:{interval:5,textStyle:{fontSize:24}}},yAxis:{type:"value",axisLabel:{textStyle:{fontSize:24},formatter:function(e){return 0!==e?e:void 0}}},series:[{name:"进入高峰",type:"line",smooth:!0,itemStyle:{normal:{opacity:0}},lineStyle:{normal:{color:"#ff6600",opacity:0}},areaStyle:{normal:{color:"#89a8b9"}},markPoint:{symbol:"path://M 5.477 69.249 l 89.081 9.082 v 46.07 c 0 5.522 4.477 10 10 10 h 304 c 5.522 0 10 -4.478 10 -10 v -112 c 0 -5.523 -4.478 -10 -10 -10 h -304 c -5.523 0 -10 4.477 -10 10 v 46.07",symbolSize:[156,70],symbolOffset:["78",0],label:{normal:{textStyle:{fontSize:24},position:"insideRight",formatter:function(e){var t=m.x[e.data.coord[0]];return"进入高峰 \n"+e.value+"  "+t+" "}}},data:[{type:"max",name:"最大值"}]}},{name:"驶出高峰",type:"line",smooth:!0,itemStyle:{normal:{opacity:0}},lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:"#2ec3ed"}},markPoint:{symbol:"path://M 5.477 69.249 l 89.081 9.082 v 46.07 c 0 5.522 4.477 10 10 10 h 304 c 5.522 0 10 -4.478 10 -10 v -112 c 0 -5.523 -4.478 -10 -10 -10 h -304 c -5.523 0 -10 4.477 -10 10 v 46.07",symbolSize:[156,70],symbolOffset:["78",0],label:{normal:{textStyle:{fontSize:24},position:"insideRight",formatter:function(e){var t=m.x[e.data.coord[0]];return"驶出高峰 \n"+e.value+"  "+t+" "}}},data:[{type:"max",name:"最大值"}]}}]},o=[156,70],s=o,l=[],c=moment().startOf("hour").hour(8),u=moment().startOf("hour").hour(20).valueOf();c.valueOf()<=u;)l.push(c.format("H:mm")),c.add(10,"m");var d,m,p={init:function(e){d=echarts.init(e),d.setOption(i)},setData:function(){s=o,moment().startOf("hour").hour(8).add(10,"m").isAfter(moment())?(m=r([],[]),a()):t.getCarInOut().then(function(e){m=r(e[0],e[1]),a()})}};return p}]),angular.module("BigScreen.Portal").controller("ParkingAreaController",["$scope","$timeout","ParkingAreaService","ParkingChart",function(e,t,r,n){e.init=function(){n.init(document.getElementById("parking-chart")),n.setData(),r.leaveAvgTime().then(function(t){e.leaveTime=t.time<0?0:moment.duration(t.time).asMinutes().toFixed(0)})},e.$on("theMin",function(){n.setData()})}]),angular.module("BigScreen.Portal").controller("OfficeSpaceController",["$scope",function(e){e.firstRooms=[{location:"0807w-E",name:"工位区",type:"work"},{location:"0807w-D",name:"工位区",type:"work"},{location:"0807w-Y03",name:"休闲区",type:"rest"},{location:"0807w-C",name:"工位区",type:"work"},{location:"0807w-B",name:"工位区",type:"work"},{location:"0807w-A",name:"工位区",type:"work"},{location:"0807w-Y02",name:"休闲区",type:"rest"},{location:"0807w-Y01",name:"休闲区",type:"rest"}],e.secondRooms=[{location:"0807w-Y06",name:"休闲区",type:"rest"},{location:"0807w-Y05",name:"休闲区",type:"rest"},{location:"0807w-Y04",name:"休闲区",type:"rest"}]}]),angular.module("BigScreen.Portal").controller("MeetingRoomController",["$scope",function(e){e.rooms=[{id:24,sign:"eba8612347af80999a60e9d32ff9a270",no:"8-7-1-W",name:"十里亭",location:"0807w-W07"},{id:25,sign:"af742effbfbabb0c0043e113707a7b99",no:"8-7-2-W",name:"幽篁里",location:"0807w-W06"},{id:26,sign:"f12bd9d4fb58a2be67d821d16a04248d",no:"8-7-3-W",name:"文昌阁",location:"0807w-W05"},{id:27,sign:"43ae0b1b9638aed3e693b1990a1484ff",no:"8-7-4-W",name:"勿幕阁",location:"0807w-W03"},{id:28,sign:"bb8d610ad4116a57cd483dddfa8b589c",no:"8-7-5-W",name:"安定阁",location:"0807w-W04"},{id:29,sign:"3f9d862dbacb88651348c35d74be0419",no:"8-7-8-W",name:"安远阁",location:"0807w-W01",showCondition:!0},{id:30,sign:"c262abdabff07f170a5b37afdfa272b8",no:"8-7-9-W",name:"尚检阁",location:"0807w-W02",showCondition:!0}]}]),angular.module("BigScreen.Portal").factory("EnvironmentService",["$q","$$Thing","ApiService","ElectricityService",function(e,t,r,n){function a(e){var t=0;return e.beehive_user_count.buckets.forEach(function(e){return"non_beehive_user"===e.key?(t=e.doc_count,!0):void 0}),t}function i(e){return 0===e?0:(e=Math.floor(e/10)+1,e>10?10:e)}function o(e){var t,r,n={beehive:0,beehive_display:0,guest:0,guest_display:0};e.forEach(function(e){switch(e.key){case"east_in":t=e.beehive_user_count.buckets,n.guest+=a(e),n.beehive+=e.beehive_user_count.buckets.length-1;break;case"south_in":r=e.beehive_user_count.buckets,n.guest+=a(e),n.beehive+=e.beehive_user_count.buckets.length-1;break;case"east_out":case"south_out":}});var o=_.intersectionBy(t,r,"key"),l=o.length;return o.find(function(e){return"non_beehive_user"===e.key})&&l--,n.beehive-=l,n.beehive_display=i(n.beehive),n.guest=Math.round(n.guest*s),n.guest_display=i(n.guest),n}var s=.3,l={getThingsLatestStatus:function(){var t=e.defer();return r.Environment.getThingsLatestStatus({startDateTime:moment().startOf("day").valueOf(),endDateTime:9999999999999}).$promise.then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},showPeople:function(){var t=e.defer();return r.Environment.getFacialIdentify({startDateTime:moment().startOf("day").valueOf(),endDateTime:moment().endOf("day").millisecond(0).valueOf()}).$promise.then(function(e){try{t.resolve(o(e.aggregations.action.buckets))}catch(r){console.log("no facial identify data."),t.resolve(o([]))}},function(e){t.reject(e)}),t.promise},usage:function(){var t=e.defer();return r.Environment.searchThings({location:"0807W",includeSubLevel:!0,type:"EnvironmentSensor"}).$promise.then(function(e){var t=e.things.map(function(e){return e.thingID});return r.Environment.detectPIR({thingList:t}).$promise}).then(function(e){var r=0;e.forEach(function(e){e.states.PIR&&r++}),t.resolve({pir:r,space:e.length})},function(e){t.reject(e)}),t.promise},getWh:function(){return n.getWh()}};return l}]),angular.module("BigScreen.Portal").controller("EnvironmentController",["$scope","$interval","EnvironmentService",function(e,t,r){function n(){r.showPeople().then(function(t){e.population=t}),r.usage().then(function(t){e.usage=t.pir/t.space,m.setOption(d(t))}),r.getThingsLatestStatus().then(function(e){a(e)}),r.getWh().then(function(t){p.setOption(u(t)),e.electricityReady=!0})}function a(t){try{var r,n,a,s=0,l=0,c=0,u=0,d=0,m=0;t.aggregations.group_by_target.buckets.forEach(function(e){r=i(e,"Temp"),void 0!==r&&(s+=r,l++),n=i(e,"CO2"),void 0!==n&&(c+=n,u++),a=i(e,"PM25"),void 0!==a&&(d+=a,m++)}),r=l?(parseFloat(s)/l).toFixed(1):0/0,n=u?(c/u).toFixed(0):0/0,a=m?(d/m).toFixed(0):0/0,e.status={temp:parseFloat(r),co2:parseInt(n),pm25:parseInt(a)},o()}catch(p){console.warn("ThingsLatestStatus data error.")}}function i(e,t){try{return e.latest_record.hits.hits[0]._source.state[t]}catch(r){return void 0}}function o(){e.tempLevel=s(e.status.temp),e.co2Level=l(e.status.co2),e.pm25Level=c(e.status.pm25)}function s(e){return isNaN(e)?void 0:4>=e?{text:"很冷",level:"bad"}:8>=e?{text:"冷",level:"bad"}:13>=e?{text:"凉",level:"normal"}:18>=e?{text:"凉爽",level:"normal"}:23>=e?{text:"舒适",level:"good"}:29>=e?{text:"温暖",level:"good"}:35>=e?{text:"热",level:"bad"}:{text:"炎热",level:"bad"}}function l(e){return isNaN(e)?"":600>=e?{text:"优",level:"good"}:1e3>=e?{text:"良",level:"normal"}:{text:"劣",level:"bad"}}function c(e){return isNaN(e)?"":35>=e?{text:"优",level:"good"}:75>=e?{text:"良",level:"good"}:115>=e?{text:"轻度污染",level:"normal"}:150>=e?{text:"中度污染",level:"bad"}:250>=e?{text:"重度污染",level:"bad"}:{text:"严重污染",level:"bad"}}function u(e){return{tooltip:{trigger:"item",formatter:"{b}: {c} kW ({d}%)"},series:[{name:"能耗分析",type:"pie",radius:[0,"65%"],data:[{value:Math.round(e.airLighting.yesterday),name:"照明+空调",itemStyle:{normal:{color:"#ff6600"}},label:{normal:{show:!0,formatter:function(t){return"照明+空调\n"+t.value+" WH\n"+e.airLighting.lastWeek+" (上周均值比)"},textStyle:{fontSize:30}}},selected:!0},{value:Math.round(e.socket.yesterday),name:"插座",itemStyle:{normal:{color:"#2aabe2"}},label:{normal:{show:!0,formatter:function(t){return"插座\n"+t.value+" WH\n"+e.socket.lastWeek+" (上周均值比)"},textStyle:{fontSize:30}}}}],label:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},labelLine:{show:!0}}]}}function d(e){return{tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},series:[{name:"空间利用率",type:"pie",radius:["30%","70%"],label:{normal:{show:!1,position:"center"}},labelLine:{normal:{show:!1}},data:[{value:e.pir,name:"人员",itemStyle:{normal:{color:"#48abdd"}}},{value:e.space-e.pir,name:"空",itemStyle:{normal:{color:"#cae2ef"}}}]}]}}e.population={total:0,beehive:0,beehive_display:0,guest:0,guest_display:0},e.usage=0,e.status={temp:0/0,co2:0/0,pm25:0/0};var m=echarts.init(document.getElementById("population-chart")),p=echarts.init(document.getElementById("electricity-chart"));n(),e.$on("theMin",n)}]),angular.module("BigScreen.Portal").factory("ElectricityService",["$q","$$Thing","ApiService",function(e,t,r){function n(){d={airLighting:{yesterday:numeral(0),lastWeek:numeral(0)},socket:{yesterday:numeral(0),lastWeek:numeral(0)}}}function a(e){var t=e.yesterday.value();e.lastWeek.divide(7);var r=e.lastWeek.value();e.lastWeekValue=numeral(t).subtract(r).divide(r),e.lastWeek=e.lastWeekValue.format("+0%"),e.yesterday=t}function i(){a(d.airLighting),a(d.socket)}function o(e,t,r){var n=e.maxValue.value||0,a=e.minValue.value||0;d[t][r]=d[t][r].add(n).subtract(a)}function s(e,t){var n=r.Environment.searchHistoryStatesAggregation({},{thingID:e.kiiThingID,stateField:"state.Wh",startDateTime:moment().subtract(1,"days").startOf("day").valueOf(),endDateTime:moment().startOf("day").valueOf()}).$promise;return n.then(function(e){o(e.aggregations,t,"yesterday")}),n}function l(e,t){var n=r.Environment.searchHistoryStatesAggregation({},{thingID:e.kiiThingID,stateField:"state.Wh",startDateTime:moment().day(-7).startOf("day").valueOf(),endDateTime:moment().day(0).startOf("day").valueOf()}).$promise;return n.then(function(e){o(e.aggregations,t,"lastWeek")}),n}function c(){u=[];var e=[];return m.forEach(function(t){var n=r.Environment.queryThingInfo({vendorThingID:t.vendorThingID}).$promise;n.then(function(e){u.push(s(e,t.type)),u.push(l(e,t.type))}),e.push(n)}),e}var u=[],d={},m=[{vendorThingID:"0807W-Z00-N-002",type:"airLighting"},{vendorThingID:"0807W-Z00-N-034",type:"airLighting"},{vendorThingID:"0807W-Z00-N-003",type:"socket"},{vendorThingID:"0807W-Z00-N-035",type:"socket"}],p={getWh:function(){n();var t=e.defer();return e.all(c()).then(function(){return e.all(u)}).then(function(){i(),t.resolve(d)}),t.promise}};return p}]),angular.module("BigScreen.Portal").controller("ApiUsageController",["$scope","$interval","ApiService",function(e,t,r){function n(){r.ApiUsage.query({},{startDateTime:moment().startOf("month").valueOf(),endDateTime:9999999999999,orderByCount:"desc",groupBy:"apiname"}).$promise.then(function(t){e.apiUsage=t.aggregations.callingCount.buckets.slice(0,5)})}e.apis=["POI点位采集","信息展示大屏幕","自动灯控","门禁红绿灯","新风自动调节","工位预定App"],n();t(function(){n()},6e4)}]),angular.module("BigScreen.AppShared").factory("WebSocketClient",["$rootScope","$timeout","SessionService",function(e,t,r){function n(){var e=r.getPortalAdmin();e?(a=Stomp.client(wsUrl),a.connect({Authorization:"Bearer "+e.accessToken},s,l),a.debug=angular.noop()):t(n,5e3)}var a={},i=[],o=5,s=function(t){console.log("STOMP Connected: "+t),e.$broadcast("stomp.connected")},l=function(e){console.log("STOMP ERROR:",e),o>0&&(t(n,5e3),console.log("STOMP: Reconnecting in 5 seconds"),o--)};return n(),{isConnected:function(){return a.connected||!1},subscribe:function(t,r,n,o){var s="/topic/"+t+"/"+r;i.push(s);var l=a.subscribe(s,function(){var t=arguments;t[0]=JSON.parse(t[0].body),e.$apply(function(){n.apply(a,t)})},o);return l},unsubscribeAll:function(){for(var e=0;e<a.subscriptions.length;e++)a.subscriptions[e].unsubscribe()},send:function(e,t,r){a.send(e,t,r)},disconnect:function(t){a.disconnect(function(){var r=arguments;e.$apply(function(){t.apply(a,r)})})}}}]),angular.module("BigScreen.AppShared").factory("ThirdPartyWsClient",["$rootScope","$timeout","SessionService",function(e,t,r){function n(){var e=r.getPortalAdmin();e?(a=Stomp.client(thirdPartyWsUrl),a.connect({apiKey:thirdPartyAPIKey},s,l),a.debug=angular.noop()):t(n,5e3)}var a={},i=[],o=5,s=function(t){console.log("3rd STOMP Connected: "+t),e.$broadcast("3rd_stomp.connected")},l=function(e){console.log("3rd STOMP ERROR:",e),o>0&&(t(n,5e3),console.log("3rd STOMP: Reconnecting in 5 seconds"),o--)};return n(),{isConnected:function(){return a.connected||!1},subscribe:function(t,r,n){var o=t;if(!(i.indexOf(o)>-1)){i.push(o);var s=a.subscribe(o,function(){var t=arguments;t[0]=JSON.parse(t[0].body),e.$apply(function(){r.apply(a,t)})},n);return s}},unsubscribeAll:function(){for(var e=0;e<a.subscriptions.length;e++)a.subscriptions[e].unsubscribe()},send:function(e,t,r){a.send(e,t,r)},disconnect:function(t){a.disconnect(function(){var r=arguments;e.$apply(function(){t.apply(a,r)})})}}}]),angular.module("BigScreen.AppShared").factory("StatusDetector",["$rootScope","SessionService",function(){return{detectSpecificType:function(e,t){switch(t){case"FreshAir":this.detectFreshAir(e);break;case"EnvironmentSensor":this.detectPIR(e);break;case"Lighting":this.detectLighting(e)}},detectAll:function(e){this.detectLighting(e),this.detectFreshAir(e),this.detectPIR(e)},detectLighting:function(e){e.things.hasOwnProperty("Lighting")&&(e.light=0,e.things.Lighting.forEach(function(t){t.status&&(e.light=e.light|t.status.Power)}))},detectFreshAir:function(e){e.things.hasOwnProperty("FreshAir")&&(e.air=0,e.things.FreshAir.forEach(function(t){t.status&&(e.air=e.air|t.status.Power)}))},detectPIR:function(e){e.things.hasOwnProperty("EnvironmentSensor")&&(e.person=0,e.things.EnvironmentSensor.forEach(function(t){t.status&&(e.person=e.person|t.status.PIR)}))}}}]),angular.module("BigScreen.AppShared").factory("RoomSensorService",["$rootScope","$$Location","$$Schema","WebSocketClient","StatusDetector",function(e,t,r,n,a){function i(e,t){var r;e.things[t].forEach(function(i){i.kiiAppID&&i.kiiThingID&&(r=n.subscribe(i.kiiAppID,i.kiiThingID,function(r){angular.extend(i.status,r.state),a.detectSpecificType(e,t)}),r&&e.subscriptions.push(r))})}function o(e,t){c.forEach(function(a){if(e.things.hasOwnProperty(a)&&(i(e,a),t&&"EnvironmentSensor"===a&&!e.monitoring)){var o=e.things.EnvironmentSensor[0];r.getByType({thingType:o.type,name:o.schemaName,version:o.schemaVersion}).$promise.then(function(t){o.schema=t.content.statesSchema.properties,l(e,o);var r=n.subscribe(o.kiiAppID,o.kiiThingID,function(t){o.status=t.state,l(e,o)});e.subscriptions.push(r)}),e.monitoring=!0}})}function s(e,t){var r=angular.copy(t);return r.name=e.schema[t.state].displayNameCN,r}function l(e,t){var r=[];u.forEach(function(e){if(t.status.hasOwnProperty(e.state)){switch(e.express){case">":if(t.status[e.state]<e.condition)return;break;case"<":if(t.status[e.state]>e.condition)return}r.push(s(t,e))}}),r.length>0&&(e.conditions=r)}var c=["FreshAir","EnvironmentSensor","Lighting"],u=[{state:"CO2",condition:800,express:">",desc:"新风已自动开启"},{state:"Temp",condition:18,express:"<",desc:"空调已自动开启"},{state:"Temp",condition:30,express:">",desc:"空调已自动开启"}];return{run:function(r,i){r.things||(r.things={}),r.subscriptions=[],t.getAllThingsByLocation({location:r.location}).$promise.then(function(t){t.forEach(function(e){r.things.hasOwnProperty(e.type)||(r.things[e.type]=[]),r.things[e.type].push(e)}),a.detectAll(r),n.isConnected()?o(r,i):e.$on("stomp.connected",function(){o(r,i)})})},stop:function(e){e.subscriptions.forEach(function(e){e.unsubscribe()})}}}]),angular.module("BigScreen.AppShared").factory("GeofenceService",["$rootScope","$q","$interval","SessionService","ApiService",function(e,t,r,n,a){function i(e,t){if(e.floor!==t.floor)return!1;for(var r=t.scope,n=r.length,a=0,i=0;n>i;i++){var s=(i+1)%n,l=o(e.lng,e.lat,r[i].lng,r[i].lat,r[s].lng,r[s].lat);if(!l)break;a++}return a===n}function o(e,t,r,n,a,i){var o=numeral(t).subtract(n).multiply(numeral(a).subtract(r)).subtract(numeral(e).subtract(r).multiply(numeral(i).subtract(n)));return 0>=o}function s(e){var r=d[e],n=t.defer();return a.POI.get({userID:r.key,startDateTime:(new Date).valueOf()-3e4},function(e){n.resolve(l(e.hits))}),n.promise}function l(e){var t={lng:0,lat:0,floor:0};try{if(0===e.total)return t;t.lng=e.hits[0]._source.object.x,t.lat=e.hits[0]._source.object.y,t.floor=e.hits[0]._source.object.floor}catch(r){console.log("poi data error.")}return t}function c(){var r=t.defer();return t.all([s(0),s(1),s(2)]).then(function(t){m.isNear=!1;var n;d.forEach(function(e,r){e.isIn=m.isIn(t[r]),m.isNear=m.isNear||e.isIn,e.isIn&&!n&&(n=e)}),m.isNear?(!m.vip||n.priority<m.vip.priority)&&(m.vip=n,e.$broadcast("new VIP",m.vip.name)):m.vip=void 0,r.resolve()}),r.promise}var u=[{location:"打印室",floor:8,scope:[{lng:120.02849,lat:30.27817},{lng:120.028462,lat:30.278243},{lng:120.028538,lat:30.278272},{lng:120.028571,lat:30.278195}]},{location:"公共区域",floor:8,scope:[{lng:120.028391,lat:30.278142},{lng:120.02836,lat:30.278222},{lng:120.028519,lat:30.278262},{lng:120.028547,lat:30.278188}]}],d=[{priority:1,name:"Bill",key:"0bea9fe760aaa85df7d953d6ab38d2e56692ddd8",pics:[{text:"Introduction of Geofence Tech on Beehive",img:"VIP_01.png"},{text:"置业项目 x 智能楼宇平台展建",img:"VIP_02.png"},{text:"实验室大数据",img:"VIP_07.png"}]},{priority:2,name:"Dolf",key:"a84feeebde4e496389b9161d7d64e565645b759f",pics:[{text:"Introduction of Geofence Tech on Beehive",img:"VIP_01.png"},{text:"智能楼宇管理平台 & API Proxy Store",img:"VIP_04.png"},{text:"优惠讯息推送",img:"VIP_05.png"}]},{priority:3,name:"oldKim",key:"a2e3a03c81aa83c5ac451b195d2f8d4b0eb37c97",pics:[{text:"Introduction of Geofence Tech on Beehive",img:"VIP_01.png"},{text:"置业部办公室 — 实验室设备与系统集成",img:"VIP_03.png"},{text:"近期活动资讯",img:"VIP_06.png"}]}],m=(r(function(){m.current&&c()},1e4),{rotative:!0,isNear:!1,vip:void 0,current:void 0,last:void 0,scopes:u,isIn:function(e){return i(e,this.current)}});return m}]),angular.module("BigScreen.Portal").factory("ApiService",["SessionService","$resource",function(e,t){var r=e.getPortalAdmin()||{},n={Authorization:"Bearer "+r.accessToken,apiKey:thirdPartyAPIKey},a={ApiUsage:t(thirdPartyAPIUrl+"dataUtilization/OpenApiCallingCount",{},{query:{headers:n,method:"POST"}}),Environment:t(thirdPartyAPIUrl,{},{getFacialIdentify:{url:thirdPartyAPIUrl+"facialIdentify/aggregate",method:"GET",headers:n,params:{startDateTime:"@startDateTime",endDateTime:"@endDateTime"}},getThingsLatestStatus:{url:thirdPartyAPIUrl+"dataUtilization/ThingsLatestStatusQuery",method:"POST",headers:n,params:{startDateTime:"@startDateTime",endDateTime:"@endDateTime"}},searchHistoryStatesAggregation:{url:thirdPartyAPIUrl+"dataUtilization/searchHistoryStatesAggregation",method:"POST",headers:n},searchThings:{url:thirdPartyAPIUrl+"locationTag/searchThings",method:"POST",headers:n,transformResponse:function(e){return{things:angular.fromJson(e)}}},detectPIR:{url:thirdPartyAPIUrl+"EnvironmentSensor/PIR",method:"POST",isArray:!0,headers:n},getElectricMeter:{url:thirdPartyAPIUrl+"ElectricMeter/Wh",method:"POST",isArray:!0,headers:n},getElectricMeterP:{url:thirdPartyAPIUrl+"ElectricMeter/P",method:"POST",isArray:!0,headers:n,params:{thingList:[5494,5495,4928,5496,5498,5497]}},queryThingInfo:{url:thirdPartyAPIUrl+"dataUtilization/queryThingInfoByVendorThingID",method:"GET",headers:n,params:{vendorThingID:"@vendorThingID"}}}),MeetingRoom:t(thirdPartyAPIUrl+"dataUtilization/fetchBookListByRoomId",{},{get:{headers:n,params:{sign:"@sign",id:"@id"}}}),ParkingArea:t(thirdPartyAPIUrl,{},{getCarInFrequency:{url:thirdPartyAPIUrl+"dataUtilization/CarInFrequency",method:"GET",headers:n,params:{startTime:"@startTime",endTime:"@endTime"}},getCarOutFrequency:{url:thirdPartyAPIUrl+"dataUtilization/CarOutFrequency",method:"GET",headers:n,params:{startTime:"@startTime",endTime:"@endTime"}},leaveAvgTime:{url:thirdPartyAPIUrl+"dataUtilization/leaveAvgTime",method:"POST",headers:n,transformResponse:function(e){return{time:angular.fromJson(e)}}}}),Personneel:t(thirdPartyAPIUrl,{},{identifyFrequency:{url:thirdPartyAPIUrl+"facialIdentify/identifyFrequency",method:"POST",headers:n},searchByStranger:{url:thirdPartyAPIUrl+"facialIdentify/searchByStranger",method:"POST",headers:n},searchLatestRecord:{url:thirdPartyAPIUrl+"facialIdentify/searchLatestRecord",method:"POST",headers:n}}),POI:t(thirdPartyAPIUrl,{},{get:{url:thirdPartyAPIUrl+"locationGeo/searchUser",method:"POST",headers:n,params:{userID:"@userID",startDateTime:"@startDateTime",endDateTime:9999999999999,size:1,from:0,inv:1,orderByTimestamp:"desc"}}})};return a}]),angular.module("BigScreen.AppShared").filter("leftHalf",function(){return function(e){var t=[];return _.each(e,function(e,r){r%2!=0&&t.push(e)}),t}}).filter("rightHalf",function(){return function(e){var t=[];return _.each(e,function(e,r){r%2!=1&&t.push(e)}),t}}).filter("range",function(){return function(e,t,r){t=parseInt(t),r=parseInt(r);for(var n=t;r>n;n++)e.push(n);return e}}).filter("celsius",function(){return function(e){return isNaN(e)?"":angular.isNumber(parseFloat(e))?"/"+e+"˚C":""}}).filter("percentage",function(){return function(e){return angular.isNumber(parseInt(e))?e+"%":""}}).filter("tempLevel",function(){return function(e){return isNaN(e)?"":4>=e?"很冷/":8>=e?"冷/":13>=e?"凉/":18>=e?"凉爽/":23>=e?"舒适/":29>=e?"温暖/":35>=e?"热/":"炎热/"}}).filter("co2Level",function(){return function(e){return isNaN(e)?"":1e3>=e?"优/":"劣/"}}).filter("pm25Level",function(){return function(e){return isNaN(e)?"":35>=e?"优/":75>=e?"良/":115>=e?"轻度污染/":150>=e?"中度污染/":250>=e?"重度污染/":"严重污染/"}}).filter("bar",function(){return function(e,t){return void 0===t&&(t=0),isNaN(e)?0:e+t}}).filter("percent",function(){return function(e){return numeral(e).format("0.[00]%")}}),angular.module("BigScreen.Secure",["BigScreen.AppShared"]),angular.module("BigScreen.Secure").factory("SessionService",["localStorageService","$rootScope","AppConfig",function(e,t,r){var n={};return n.setPortalAdmin=function(n){e.set(r.USER_SESSION,n),t.portalAdmin=n},n.getPortalAdmin=function(){var t=e.get(r.USER_SESSION);return t?t:void(window.location="/bigscreen-front")},n.expire=function(){t.portalAdmin=null,e.remove(r.USER_SESSION)},n.restore=function(){e.get(r.USER_SESSION)},n.restore(),n}]),angular.module("BigScreen.Secure").factory("SecurityService",["localStorageService","AppUtils","SessionService","$$Auth",function(e,t,r,n){function a(){this.unauthorized=!1}var i={};return i.errorHandler=function(e){var t=new a;switch(e.status){case"Unauthorized":t.unauthorized=!0
}return t},i.login=function(){return n.login({password:"1qaz2wsx",permanentToken:!0,userName:"beehive_admin"}).$promise},i}]),angular.module("BigScreen.Secure").controller("SecureController",["$timeout","$state","AppUtils","SecurityService","SessionService",function(e,t,r,n,a){r.showLoading(),n.login().then(function(n){a.setPortalAdmin(n),r.hideLoading(),e(function(){t.go("app.Portal.OfficeSpace")},5e3)},function(e){console.log(e),r.hideLoading()})}]),angular.module("BigScreen.Portal").factory("PortalService",["AppUtils","$state",function(e,t){var r={};return r.getStateDisplayName=function(e){return t.get(e).getName()},r.getStateChan=function(e){var r=[];r.push(e);for(var n=e;n.previous;)n=t.get(n.previous),r.push(n);return r.reverse(),r},r.isActive=function(e){var n=r.getStateChan(t.current),a=t.get(e);return n.indexOf(a)>-1},r.getPortalNavs=function(){return[{name:"办公空间总览",state:t.get("app.Portal.OfficeSpace"),icon:"fa-globe"},{name:"办公环境监控",state:t.get("app.Portal.Environment"),icon:"fa-tachometer"},{name:"会议室",state:t.get("app.Portal.MeetingRoom"),icon:"fa-th-list"},{name:"智能停车场",state:t.get("app.Portal.ParkingArea"),icon:"fa-car"},{name:"办公室人流进出高峰",state:t.get("app.Portal.Personnel"),icon:"fa-users"},{name:"IB平台集成信息",state:t.get("app.Portal.ApiUsage"),icon:"fa-list-ol"}]},r}]),angular.module("BigScreen.Portal").factory("$$Auth",["$resource",function(e){var t=e(MyAPIs.OPERATOR,{},{initpassword:{method:"POST",url:MyAPIs.OPERATOR+"/initpassword"},activate:{url:MyAPIs.OPERATOR+"/activate",method:"POST"},login:{url:MyAPIs.OPERATOR+"/login",method:"POST"},logout:{url:MyAPIs.OPERATOR+"/logout",method:"POST"},validate:{url:MyAPIs.OPERATOR+"/validatetoken",method:"POST"}});return t}]).factory("$$Location",["$resource","SessionService",function(e,t){var r=t.getPortalAdmin()||{},n={Authorization:"Bearer "+r.accessToken},a=e(MyAPIs.TAG+"/:id",{id:"@tagName"},{queryAll:{method:"GET",isArray:!0,url:MyAPIs.TAG+"/search?tagType=Location"},getTopLevel:{method:"GET",url:MyAPIs.LOCATION_TAGS+"/topLevel",isArray:!0,cache:!0},getSubLevel:{method:"GET",url:MyAPIs.LOCATION_TAGS+"/:location/subLevel",params:{type:"@location"},isArray:!0,cache:!0},getThingsByLocation:{method:"GET",url:MyAPIs.LOCATION_TAGS+"/:location/things",params:{type:"@location"},isArray:!0},getAllThingsByLocation:{method:"GET",url:MyAPIs.LOCATION_TAGS+"/:location/allThings",headers:n,params:{location:"@location"},isArray:!0},getParent:{method:"GET",url:MyAPIs.LOCATION_TAGS+"/:location/parent",isArray:!0}});return a}]).factory("$$Permission",["$resource",function(e){var t=e(MyAPIs.PERMISSION,{},{get:{url:MyAPIs.SYSTEM_PERMISSION,method:"GET"}});return t}]).factory("$$Schema",["$resource",function(e){var t=e(MyAPIs.SCHEMA,{},{getByType:{url:MyAPIs.SCHEMA+"/query/industrytemplate",method:"GET",cache:!0,params:{thingType:"@thingType",name:"@name",version:"@version"}}});return t}]).factory("$$Supplier",["$resource",function(e){var t=e(MyAPIs.SUPPLIER,{},{getAll:{url:MyAPIs.SUPPLIER+"/all",method:"GET",isArray:!0}});return t}]).factory("$$Tag",["$resource",function(e){var t=e(MyAPIs.TAG+"/:id",{id:"@tagName"},{query:{method:"GET"},queryAll:{url:MyAPIs.TAG+"/search?tagType=Custom",method:"GET",isArray:!0},create:{url:MyAPIs.TAG+"/custom",method:"POST"},update:{url:MyAPIs.TAG+"/custom",method:"POST"},remove:{url:MyAPIs.TAG+"/custom/:id",params:{id:"@tagName"},method:"DELETE"}});return t}]).factory("$$Thing",["$resource","SessionService",function(e,t){var r=t.getPortalAdmin()||{},n={Authorization:"Bearer "+r.accessToken},a=e(MyAPIs.THING+"/:globalThingID",{},{getGateways:{url:MyAPIs.THING+"/gateway",method:"GET",isArray:!0},save:{url:MyAPIs.THING,params:{globalThingID:"@globalThingID"},method:"POST"},getAll:{url:MyAPIs.THING+"/search",method:"GET",isArray:!0},remove:{method:"DELETE"},bindTags:{url:MyAPIs.THING+"/:thingids/tags/custom/:tags",params:{thingids:"@things",tags:"@tags"},method:"POST"},removeTags:{url:MyAPIs.THING+"/:things/tags/custom/:tags",params:{things:"@things",tags:"@tags"},method:"DELETE"},byTag:{url:MyAPIs.THING+"/search?tagType=:tagType&displayName=:displayName",params:{tagType:"@tagType",displayName:"@displayName"},method:"GET",isArray:!0},byType:{url:MyAPIs.THING+"/types/:typeName",params:{typeName:"@typeName"},method:"GET",isArray:!0},sendCommand:{url:MyAPIs.THING_IF+"/command/",method:"POST",isArray:!0},getTypeByTag:{method:"GET",url:MyAPIs.THING+"/types/fulltagname/:fullTagNames",isArray:!0,params:{fullTagNames:"@fullTagNames"}},getTriggers:{method:"GET",url:MyAPIs.TRIGGER+"/things/:globalThingID",isArray:!0,params:{globalThingID:"@globalThingID"}},getOnboardingInfo:{method:"GET",url:MyAPIs.ONBOARDING+"/:vendorThingID",params:{vendorThingID:"@vendorThingID"}},getEndNodes:{url:MyAPIs.THING+"/:globalThingID/endnodes",params:{globalThingID:"@globalThingID"},method:"GET",isArray:!0},getEndNode:{url:MyAPIs.CLOUD_THING_IF+"/apps/:kiiAppID/targets/THING::thingID/states",params:{thingID:"@thingID",kiiAppID:"@kiiAppID"},headers:{Authorization:"Bearer c63Z840BhnyLgyL6TAoKeq0iGdUM6L1vZemenWrWjxc"},method:"GET"},replaceEndNode:{url:MyAPIs.CLOUD_THING_IF+"/apps/:kiiAppID/things/:kiiThingID/end-nodes/:thingID",params:{thingID:"@thingID",kiiAppID:"@kiiAppID",kiiThingID:"@kiiThingID"},headers:{Authorization:"Bearer c63Z840BhnyLgyL6TAoKeq0iGdUM6L1vZemenWrWjxc"},transformRequest:function(e){return e=_.clone(e),_.each(e,function(t,r){"endNodeVendorThingID"!=r&&"endNodePassword"!=r&&delete e[r]}),JSON.stringify(e)},method:"PATCH"},removeEndNode:{method:"DELETE",url:MyAPIs.CLOUD_THING_IF+"/apps/:kiiAppID/things/:kiiThingID/end-nodes/:thingID",params:{thingID:"@thingID",kiiAppID:"@kiiAppID",kiiThingID:"@kiiThingID"},headers:{Authorization:"Bearer c63Z840BhnyLgyL6TAoKeq0iGdUM6L1vZemenWrWjxc"}},getCommands:{method:"POST",url:MyAPIs.THING_IF+"/command/list",isArray:!0},getThingsByLocationType:{url:MyAPIs.REPORTS+"/thingQuery",method:"POST",isArray:!0},getThingsByIDs:{url:MyAPIs.THING+"/queryDetailByIDs",method:"POST",isArray:!0},getThingsByVendorID:{url:MyAPIs.THING+"/vendorThingID/:vendorThingID",method:"GET",headers:n,params:{vendorThingID:"@vendorThingID"}}});return a}]).factory("$$Trigger",["$resource",function(e){var t=e(MyAPIs.TRIGGER,{},{getAll:{url:MyAPIs.TRIGGER+"/all",method:"GET",isArray:!0,transformResponse:function(e){return e=JSON.parse(e),e=_.reject(e,function(e){return e.type==t.TypeEnum.SIMPLE&&e.source&&e.source.thingID?!0:!1})}},get:{url:MyAPIs.TRIGGER+"/:triggerID",method:"GET"},save:{url:MyAPIs.TRIGGER+"/createTrigger",method:"POST"},remove:{url:MyAPIs.TRIGGER+"/:triggerID",method:"DELETE"},enable:{url:MyAPIs.TRIGGER+"/:triggerID/enable",method:"PUT",params:{triggerID:"@triggerID"}},disable:{url:MyAPIs.TRIGGER+"/:triggerID/disable",method:"PUT",params:{triggerID:"@triggerID"}}});return t.TypeEnum={SIMPLE:"Simple",GROUP:"Group",SUMMARY:"Summary"},t}]).factory("$$Type",["$resource",function(e){var t=e(MyAPIs.TYPE,{},{getAll:{method:"GET",isArray:!0,cache:!0},getSchema:{url:MyAPIs.SCHEMA+"?thingType=:type&name=:type&version=1",method:"GET",cache:!0},saveSchema:{url:MyAPIs.SCHEMA,method:"POST"},updateSchema:{url:MyAPIs.SCHEMA+"/:id",method:"PUT",params:{id:"@id"}},byTags:{url:MyAPIs.TYPE+"/fulltagname/:tags",params:{tags:"@tags"},method:"GET",isArray:!0}});return t}]).factory("$$User",["$resource",function(e){var t=e(MyAPIs.USER+"/:userID",{userID:"@userID"},{get:{method:"GET",url:MyAPIs.USER+"/me"},update:{method:"PATCH",url:MyAPIs.USER+"/me"},setCustomData:{url:MyAPIs.USER+"/me/customData/:name",method:"PUT",params:{name:"@name"}},getCustomData:{url:MyAPIs.USER+"/me/customData/:name",method:"GET",params:{name:"@name"}},bindThing:{url:MyAPIs.THING+"/:globalThingIDs/users/:userIDs",params:{userIDs:"@userIDs",globalThingIDs:"@globalThingIDs"},method:"POST"},unbindThing:{url:MyAPIs.THING+"/:globalThingIDs/users/:userIDs",params:{userIDs:"@userIDs",globalThingIDs:"@globalThingIDs"},method:"DELETE"},bindTag:{url:MyAPIs.TAG+"/:tags/users/:userIDs",method:"POST",params:{userIDs:"@userIDs",tags:"@tags"}},unbindTag:{url:MyAPIs.TAG+"/:tags/users/:userIDs",method:"DELETE",params:{userIDs:"@userIDs",tags:"@tags"}},getTags:{url:MyAPIs.TAG+"/user/:userID",method:"GET",params:{userID:"@userID"},isArray:!0},getThings:{url:MyAPIs.THING+"/user/:userID",method:"GET",params:{userID:"@userID"},isArray:!0},getPermissions:{url:MyAPIs.USER+"/permissionTree",method:"GET",isArray:!0},changePassword:{url:MyAPIs.USER+"/changepassword",method:"POST"},query:{url:MyAPIs.USER+"/simplequery",method:"POST",isArray:!0,transformRequest:function(e){return JSON.stringify(e)}}});return t}]).factory("$$UserGroup",["$resource",function(e){var t=e(MyAPIs.USER_GROUP+"/:id",{id:"@userGroupID"},{addUser:{method:"POST",url:MyAPIs.USER_GROUP+"/:userGroupID/user/:userID",params:{userGroupID:"@userGroupID",userID:"@userID"}},deleteUser:{method:"DELETE",url:MyAPIs.USER_GROUP+"/:userGroupID/user/:userID",params:{userGroupID:"@userGroupID",userID:"@userID"}},update:{method:"POST",url:MyAPIs.USER_GROUP},remove:{method:"DELETE"},get:{url:MyAPIs.USER_GROUP+"/:userGroupID",method:"GET",params:{userGroupID:"@userGroupID"}},getList:{url:MyAPIs.USER_GROUP+"/all",method:"GET",isArray:!0},getMyGroups:{url:MyAPIs.USER_GROUP+"/list",method:"GET",isArray:!0},withUserData:{url:MyAPIs.USER_GROUP+"/simplequery",method:"POST",transformRequest:function(e){return e.includeUserData=1,e}},create:{url:MyAPIs.USER_GROUP,method:"POST"},query:{url:MyAPIs.USER_GROUP+"/simplequery",method:"POST",isArray:!0},getPermissions:{url:MyAPIs.USER_GROUP,method:"GET"},bindThing:{url:MyAPIs.THING+"/:globalThingIDs/userGroups/:userGroupIDs",params:{userGroupIDs:"@userGroupIDs",globalThingIDs:"@globalThingIDs"},method:"POST"},unbindThing:{url:MyAPIs.THING+"/:globalThingIDs/userGroups/:userGroupIDs",params:{userGroupIDs:"@userGroupIDs",globalThingIDs:"@globalThingIDs"},method:"DELETE"},bindTag:{url:MyAPIs.TAG+"/:tags/userGroups/:userGroupIDs",params:{userGroupIDs:"@userGroupIDs",tags:"@tags"},method:"POST"},unbindTag:{url:MyAPIs.TAG+"/:tags/userGroups/:userGroupIDs",params:{userGroupIDs:"@userGroupIDs"},method:"DELETE"},getTags:{url:MyAPIs.TAG+"/userGroup/:userGroupID",params:{userGroupID:"@userGroupID"},method:"GET",isArray:!0},getThings:{url:MyAPIs.THING+"/userGroup/:userGroupID",params:{userGroupID:"@userGroupID"},method:"GET",isArray:!0}});return t}]).factory("$$UserManager",["$resource",function(e){var t=e(MyAPIs.USER_MANAGER+"/:userID",{userID:"@userID"},{update:{method:"PATCH",url:MyAPIs.USER_MANAGER+"/:userID",params:{userID:"@userID"}},remove:{method:"DELETE",url:MyAPIs.USER_MANAGER+"/:userID",params:{userID:"@userID"}},create:{url:MyAPIs.USER_MANAGER,method:"POST"},changePassword:{url:MyAPIs.USER_MANAGER+"/:userID/resetpassword",method:"POST",params:{userID:"@userID"}},query:{url:MyAPIs.USER+"/simplequery",method:"POST",isArray:!0,transformRequest:function(e){return JSON.stringify(e)}}});return t}]),angular.module("BigScreen.Portal").controller("PortalController",["$scope","$rootScope","$state","AppUtils","PortalService","SessionService","$interval","GeofenceService","WebSocketClient",function(e,t,r,n,a,i,o,s){function l(){e.time=moment().startOf("minute").valueOf(),t.$broadcast("theMin",moment(e.time)),e.time%m===0&&t.$broadcast("theHour"),c()}function c(){if(s.rotative&&!e.isVIP)for(var t=0,n=e.portalNavs.length;n>t;t++)if(e.portalNavs[t].isActive)return void r.go(e.portalNavs[(t+1)%n].state.name)}function u(){for(var t,n=0,a=e.portalNavs.length;a>n;n++)t=e.portalNavs[n],t.isActive=t.state.name==r.current.name;e.portalTitle=r.current.getName()}var d=i.getPortalAdmin();if(!d)return void r.go("app.Secure");e.portalNavs=a.getPortalNavs(),e.getStateChan=a.getStateChan,e.getStateDisplayName=a.getStateDisplayName,e.isActive=a.isActive,e.time=new Date,e.menuOff=!1,e.Geofence=s,u(),e.turnOffMenu=function(){e.menuOff=!0},e.turnOnMenu=function(){e.menuOff=!1},e.toggleMenu=function(){e.menuOff=!e.menuOff},e.getName=function(){},e.changeNav=function(t){o.cancel(p),p=o(l,6e4),e.isOpen=!1,r.go(t.state.abstract?t.state.redirectTo:t.state.name,r.params)};var m=36e5,p=o(l,6e4);e.$watch("portalNavs",function(t){t&&0!=t.length?e.turnOffMenu():e.turnOnMenu()},!0),e.$on("$stateChangeSuccess",function(){e.isVIP=r.includes("app.Portal.VIP"),e.picId=r.params.id,u()}),e.$on("new VIP",function(e,t){s.rotative=!0,r.go("app.Portal.VIP",{name:t,id:1})}),e.$on("$destroy",function(){angular.isDefined(p)&&(o.cancel(p),p=void 0)})}]),angular.module("BigScreen.Portal").constant("VIP",{BILL:"0bea9fe760aaa85df7d953d6ab38d2e56692ddd8",Dolf:"a84feeebde4e496389b9161d7d64e565645b759f",oldKim:"a2e3a03c81aa83c5ac451b195d2f8d4b0eb37c97"}),function(){var e=appConfig[appConfig.ENV].siteUrl;window.thirdPartyAPIUrl=appConfig[appConfig.ENV].thirdPartyAPIUrl,window.thirdPartyWsUrl=appConfig[appConfig.ENV].thirdPartyWsUrl,window.thirdPartyAPIKey=appConfig[appConfig.ENV].thirdPartyAPIKey;var t=appConfig[appConfig.ENV].cloudUrl,r=e+"/api";window.MyAPIs={LOCATION_TAGS:"/locationTags",OPERATOR:"/oauth2",USER:"/users",USER_MANAGER:"/usermanager",USER_GROUP:"/usergroup",THING:"/things",TAG:"/tags",TYPE:"/things/types",PERMISSION:"/permission",TRIGGER:"/triggers",THING_IF:"/thing-if",ONBOARDING:"/onboardinghelper",SUPPLIER:"/devicesuppliers",SYSTEM_PERMISSION:"/sys/permissionTree",USER_SYNC:"/usersync",SCHEMA:"/schema",REPORTS:"/reports"};for(var n in window.MyAPIs)window.MyAPIs[n]=r+window.MyAPIs[n];window.MyAPIs.CLOUD_THING_IF=t+"/thing-if",window.wsUrl=appConfig[appConfig.ENV].wsUrl;var a="Beehive";window.AppTags={USER:a+"USER",PERMISSION:a+"PERMISSION"},window.pageListMaxLength=20,window.siteUrl=e}(),angular.module("BigScreen.AppShared").factory("AppUtils",["$rootScope","$http","$location","$q","$state","$timeout","$uibModal","AppConfig",function(e,t,r,n,a,i,o,s){return window.app={},app.utils={requestInProcess:0,storagePrefix:s.StoragePrefix+".",initialize:function(){this._initialize()},_initialize:function(){this._IEPlaceholder(),e._=_,String.prototype.lowerFirstLetter=function(){return this.charAt(0).toLowerCase()+this.slice(1)},Array.prototype.removeFirst=function(){return this.slice(1,this.length)},Array.prototype.remove=function(e){var t=this.indexOf(e);return t>-1?this.splice(t,1):this}},_IEPlaceholder:function(){var e=document,t=e.getElementsByTagName("input"),r="placeholder"in e.createElement("input"),n=function(e){var t=e.getAttribute("placeholder"),r=e.defaultValue;""==r&&(e.value=t),$(e).on("focus",function(){e.value===t&&(this.value="")}),$(e).on("blur",function(){""===e.value&&(this.value=t)})};if(!r)for(var a=0,i=t.length;i>a;a++){var o=t[a],s=o.getAttribute("placeholder");"text"!==o.type&&"password"!==o.type||!s||n(o)}},setLocalStorageItem:function(e,t){localStorage.setItem(this.storagePrefix+e,JSON.stringify(t))},getLocalStorageItem:function(e){return $.parseJSON(localStorage.getItem(this.storagePrefix+e))},getSessionItem:function(e){return $.parseJSON(sessionStorage.getItem(this.storagePrefix+e))},setSessionItem:function(e,t){sessionStorage.setItem(this.storagePrefix+e,JSON.stringify(t))},clearSession:function(){sessionStorage.clear()},removeSessionItem:function(e){sessionStorage.removeItem(this.storagePrefix+e)},doLoading:function(){this.requestInProcess++,this.showLoading()},whenLoaded:function(){this.requestInProcess--,0==this.requestInProcess&&this.hideLoading()},showLoading:function(){},hideLoading:function(){},alert:function(e,t){t=t||"提示";var r="";r+='<div class="modal-content">',r+='  <div class="modal-header ng-scope">',r+='      <h3 class="modal-title">'+t+"</h3>",r+="  </div>",r+='  <div class="modal-body clearfix">',r+='    <div class="col-sm-12">',r+="      "+e,r+="    </div>",r+="  </div>",r+='  <div class="modal-footer ng-scope">',r+='      <button class="btn btn-primary" style="width:100%;" type="button" ng-click="ok()">Ok</button>',r+="  </div>",r+="</div>";var n=o.open({animation:!0,template:r,controller:["$scope","$uibModalInstance",function(e,t){e.ok=function(){t.dismiss("cancel")}}],size:"sm"});return n.result},confirm:function(e,t,r){var n="";n+='<div class="modal-content">',n+='  <div class="modal-header ng-scope">',n+='      <h3 class="modal-title">'+e+"</h3>",n+="  </div>",n+='  <div class="modal-body clearfix">',n+='    <div class="col-sm-12">',n+="      "+t,n+="    </div>",n+="  </div>",n+='  <div class="modal-footer ng-scope">',n+='      <button class="btn btn-primary" type="button" ng-click="ok()">Confirm</button>',n+='      <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>',n+="  </div>",n+="</div>";var a=o.open({animation:!0,template:n,controller:["$scope","$uibModalInstance","func",function(e,t,r){e.ok=function(){angular.isFunction(r)?t.close(r()):t.dismiss("cancel")},e.cancel=function(){t.dismiss("cancel")}}],size:"sm",resolve:{func:function(){return r}}});return a.result}},app.utils}]);var MyApp=angular.module("BigScreen",["ui.router","BigScreen.Secure","BigScreen.AppShared","BigScreen.Portal"]);MyApp.config(["$httpProvider","$stateProvider","$urlRouterProvider","$logProvider",function(e,t,r,n){delete e.defaults.headers.common["X-Requested-With"],n.debugEnabled(!1),e.defaults.headers.common["Content-Type"]="application/json",e.defaults.headers.common.Authorization="Bearer super_token",e.interceptors.push(["$q",function(e){return{request:function(e){return e.params&&e.params.inv||MyApp.utils.doLoading(),e},response:function(e){return e.config.params&&e.config.params.inv||MyApp.utils.whenLoaded(),e},responseError:function(t){return console.warn(t),t.config.params&&t.config.params.inv||MyApp.utils.whenLoaded(),502===t.status&&"UNAUTHORIZED"===t.data&&(window.location="/bigscreen-front"),t.data&&"TOKEN_TIME_OUT"===t.data.errorCode&&(window.location="/bigscreen-front"),t.data&&"LOGIN_TOKEN_INVALID"===t.data.errorCode&&(window.location="/bigscreen-front"),(401===t.status||403===t.status)&&(window.location="/bigscreen-front"),e.reject(t)}}}])}]).run(["$rootScope","$state","$stateParams","AppUtils",function(e,t,r,n){e.$state=t,e.$stateParams=r,window.state=t,MyApp.utils=n}]),angular.module("BigScreen").controller("AppController",["$scope",function(){}]),angular.module("BigScreen").config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("app",{url:"",templateUrl:"app/app.html",controller:"AppController","abstract":!0}).state("app.Secure",{url:"/",templateUrl:"app/components/Secure/Secure.html",controller:"SecureController"}).state("app.Portal",{url:"/Portal",templateUrl:"app/components/Portal/Portal.html",controller:"PortalController"}),t.otherwise("/")}]),angular.module("BigScreen.Portal").config(["$stateProvider","$urlRouterProvider",function(e){e.state("app.Portal.Welcome",{url:"/Welcome",templateUrl:"app/components/Portal/Welcome/Welcome.html",controller:"WelcomeController",getName:function(){return"Welcome"}}).state("app.Portal.OfficeSpace",{url:"/OfficeSpace",templateUrl:"app/components/Portal/OfficeSpace/OfficeSpace.html",controller:"OfficeSpaceController",getName:function(){return"办公空间总览"}}).state("app.Portal.Environment",{url:"/Environment",templateUrl:"app/components/Portal/Environment/Environment.html",controller:"EnvironmentController",getName:function(){return"办公环境监控"}}).state("app.Portal.MeetingRoom",{url:"/MeetingRoom",templateUrl:"app/components/Portal/MeetingRoom/MeetingRoom.html",controller:"MeetingRoomController",getName:function(){return"会议室"}}).state("app.Portal.ParkingArea",{url:"/ParkingArea",templateUrl:"app/components/Portal/ParkingArea/ParkingArea.html",controller:"ParkingAreaController",getName:function(){return"智能停车场"}}).state("app.Portal.Personnel",{url:"/Personnel",templateUrl:"app/components/Portal/Personnel/Personnel.html",controller:"PersonnelController",getName:function(){return"办公室人流进出高峰"}}).state("app.Portal.ApiUsage",{url:"/ApiUsage",templateUrl:"app/components/Portal/ApiUsage/ApiUsage.html",controller:"ApiUsageController",getName:function(){return"IB平台集成信息"}}).state("app.Portal.VIP",{url:"/vip/:name/{id:int}",templateUrl:"app/components/Portal/VIP/VIP.html",controller:"VIPController",getName:function(){return""},params:{id:1}})}]),angular.module("BigScreen").run(["$templateCache",function(e){e.put("app/app.html",'<div ng-init="init()"><div id="spinner" style="display:none;"><div class="loader">Loading...</div></div><div ui-view=""></div></div>'),e.put("app/components/Portal/Portal.html",'<main class="app-portal"><div class="header-bar"><div class="title">{{portalTitle}}</div><div class="menu" uib-dropdown="" is-open="isOpen" auto-close="outsideClick"><div uib-dropdown-toggle=""></div><ul class="dropdown-menu" uib-dropdown-menu="" role="menu" aria-labelledby="single-button"><li class="menuitem" ng-repeat="nav in portalNavs" ng-class="{\'active\':nav.isActive}"><a ng-click="changeNav(nav)"><i class="fa fa-fw" ng-class="nav.icon"></i> {{nav.name}}</a></li><li class="divider" ng-if="Geofence.isNear"></li><li class="menuitem" ng-if="Geofence.isNear" ng-repeat="pic in Geofence.vip.pics"><a ui-sref="app.Portal.VIP({name:Geofence.vip.name, id:$index+1})" ng-disabled="picId===$index+1" ng-click="Geofence.rotative=!1"><i class="fa fa-fw" ng-class="{\'fa-check\':picId===$index+1}"></i> 圖片{{$index+1}}</a></li><li class="divider"></li><li role="menuitem" class="input"><span>轮播:</span><switchery ng-model="Geofence.rotative"></switchery></li><li role="menuitem" class="input"><span>位置:</span><select class="form-control pull-right" ng-options="s.location for s in Geofence.scopes track by s.location" ng-model="Geofence.current"><option value="">无</option></select></li></ul></div><div class="time">{{time | date:\'EEE MMM d H:mm\'}}</div></div><div class="al-main"><div class="al-content"><div ui-view="" class="container-fluid portal-content-body" ng-class="{\'vip\':isVIP}"></div></div></div></main>'),e.put("app/components/Secure/Secure.html",'<main class="app-secure" ui-sref="app.Portal.OfficeSpace"><div class="next"><span>Next Step..</span></div><div class="al-main"><div class="al-content"><div class="content"><img src="images/img_explanation.png" height="875" weight="1839" alt=""></div></div></div></main>'),e.put("app/components/Portal/ApiUsage/ApiUsage.html",'<div class="app-portal-apiusage"><div class="pull-left"><div class="title">已支持应用</div><div class="icon-container"><div class="data-wrap"><div class="icon-api" ng-repeat="api in apis">{{api}}</div></div></div></div><div class="pull-right"><div class="title">本月API用量统计</div><div class="data-wrap"><div class="subtitle clearfix"><div class="pull-left">API</div><div class="pull-right">调用次数</div></div><ul class="api"><li class="clearfix" ng-repeat="api in apiUsage"><div class="pull-left">{{api.key}}</div><div class="pull-right">{{api.doc_count}}</div></li></ul></div></div></div>'),e.put("app/components/Portal/Environment/Environment.html",'<div class="app-portal-environment"><div class="wrap pull-left"><div class="electricity-wrap clearfix"><div class="title">用电量</div><div class="electricity"><preloader class="preloader" ng-if="!electricityReady"></preloader><div id="electricity-chart"></div></div></div><div class="population-wrap"><div class="pull-left population"><div class="title">办公室人员</div><div class="people"><div class="text">员工 /{{population.beehive}}</div><div class="people-bar"><div class="people-container"><img src="images/icon_person.png" width="23" height="57" alt="" ng-repeat="p in [] | range:0:population.beehive_display"></div></div></div><div class="people"><div class="text">访客 /{{population.guest}}</div><div class="people-bar"><div class="people-container"><img src="images/icon_person.png" width="23" height="57" alt="" ng-repeat="p in [] | range:0:population.guest_display"></div></div></div></div><div class="pull-left usage"><div class="chart-wrap"><div class="tip pull-left">空间利用率 / {{usage | percent}}</div><div id="population-chart" class="pull-left"></div></div></div></div></div><div class="pull-right air-wrap"><div class="title">办公室空气质量</div><div class="type temp clearfix"><div class="text pull-left">温度</div><div class="value pull-left"><span ng-class="tempLevel.level">{{tempLevel.text}}</span> {{status.temp | celsius}}</div><smiley-face class="pull-right" level="tempLevel"></smiley-face></div><hr><div class="type co2 clearfix"><div class="text pull-left">CO2含量</div><div class="value pull-left"><span ng-class="co2Level.level">{{co2Level.text}}</span> {{status.co2 ? \'/\' + status.co2 : \'\'}}</div><smiley-face class="pull-right" level="co2Level"></smiley-face></div><hr><div class="type pm25 clearfix"><div class="text pull-left">PM2.5</div><div class="value pull-left"><span ng-class="pm25Level.level">{{pm25Level.text}}</span> {{status.pm25 ? \'/\' + status.pm25 : \'\'}}</div><smiley-face class="pull-right" level="pm25Level"></smiley-face></div><div class="foot"><i class="fa fa-exclamation-circle" aria-hidden="true"></i> 智能模式已启动，为您自动调适最舒适环境</div></div></div>'),e.put("app/components/Portal/MeetingRoom/MeetingRoom.html",'<div class="app-portal-meetingroom"><div class="column-wrap"><div class="column" ng-repeat="room in rooms"><app-meeting-room room="room"></app-meeting-room></div></div><img src="images/icon_description.png" width="748" height="71" alt=""></div>'),e.put("app/components/Portal/OfficeSpace/OfficeSpace.html",'<div class="app-portal-officespace"><img class="bg" src="images/bg_officespace.png" alt=""><div class="room-row"><app-room ng-repeat="r in firstRooms" room="r"></app-room></div><div class="room-row second"><app-room ng-repeat="r in secondRooms track by r.location" room="r" class="sm"></app-room></div><div class="status"><img src="images/icon_description.png" width="748" height="71" alt=""></div></div>'),e.put("app/components/Portal/ParkingArea/ParkingArea.html",'<div class="app-portal-parkingarea" ng-init="init()"><div class="row"><img src="images/icon_clock.png" height="36" width="36" alt=""><div class="hint"><div class="title">离开车位 - 驶出停车场</div></div><div class="desc"><div><i class="fa fa-exclamation-circle" aria-hidden="true"></i> 记得为下次约会预留时间</div></div></div><div class="row"><div class="remark">每月平均 / <span>{{leaveTime}}分钟</span></div></div><div class="row"><img src="images/icon_clock.png" height="36" width="36" alt=""><div class="hint"><div class="title">进出高峰时段</div></div><div class="desc"><div><i class="fa fa-exclamation-circle" aria-hidden="true"></i> 提示您避开车多拥挤时段</div></div></div><div class="row"><div id="parking-chart"></div></div></div>'),e.put("app/components/Portal/Personnel/Personnel.html",'<div class="app-portal-personnel"><div class="personnel-row"><div class="personnel-area yesterday-enter"><div>昨日({{yesterday}})最早进入</div><div class="personnel" ng-if="yesterdayEnter"><img ng-src="{{yesterdayEnter.photo}}" width="174" height="174" alt="" a=""><div>{{yesterdayEnter.name}}<br><span class="time">{{yesterdayEnter.time | date:\'HH:mm\'}}</span></div></div></div><div class="personnel-area today-enter"><div>今日({{today}})最早进入</div><div class="personnel" ng-if="todayEnter"><img ng-src="{{todayEnter.photo}}" width="174" height="174" alt="" a=""><div>{{todayEnter.name}}<br><span class="time">{{todayEnter.time | date:\'HH:mm\'}}</span></div></div></div><div class="personnel-area yesterday-leave"><div>昨日({{yesterday}})最晚离开</div><div class="personnel" ng-if="yesterdayLeave"><img ng-src="{{yesterdayLeave.photo}}" width="174" height="174" alt="" a=""><div>{{yesterdayLeave.name}}<br><span class="time">{{yesterdayLeave.time | date:\'HH:mm\'}}</span></div></div></div><div class="peak-area"><div class="title">高峰时段(今日)</div><div class="peak in"><div class="sub">进入高峰</div><div class="time" ng-if="max.in">{{max.in-600000 | date:\'HH:mm\'}}~{{max.in | date:\'HH:mm\'}}</div></div><div class="peak out"><div class="sub">出去高峰</div><div class="time" ng-if="max.out">{{max.out-600000 | date:\'HH:mm\'}}~{{max.out | date:\'HH:mm\'}}</div></div></div></div><div class="row chart-row"><div id="personnel-chart"></div></div></div>'),e.put("app/components/Portal/VIP/VIP.html",'<div class="app-portal-vip"><img ng-src="{{\'images/\' + pic.img}}" height="875" weight="1839" alt=""></div>'),e.put("app/components/Portal/Welcome/Welcome.html","<div class=\"app-portal-welcome\"><h3>{{'Common.Hello'}}</h3></div>"),e.put("app/components/AppShared/directives/meeting-room/meeting-room.html",'<div class="meeting-room" ng-class="{\'busy\': room.busy}"><div class="room-head"><div class="name"><div class="title">{{room.name}}</div><div class="no">{{room.no}}</div></div><div class="status"></div></div><div class="room-body"><div class="busy" ng-if="!room.busy">未预订</div><div class="busy used" ng-if="room.busy">已被预订！</div><ul class="booking" ng-if="bookingMode"><li ng-repeat="info in room.bookInfoList">{{info.start}}-{{info.end}}</li></ul><ul class="status" ng-if="!bookingMode"><li ng-repeat="(key, value) in room.things.EnvironmentSensor[0].status" ng-if="hasSchema(key)" ng-class="{warn:hasWarn(key)}">{{getName(key)}}: {{value}}</li></ul><ul class="condition"><li ng-repeat="c in room.conditions"><div class="state">【{{c.name}}】<span>{{c.express}}{{c.condition}}</span></div><div class="desc"><span>{{c.desc}}</span></div></li></ul></div><div class="room-foot"><div class="icon-wrap"><div class="icon icon-room light" ng-class="{\'off\': !room.light}"></div><div class="vl"></div><div class="icon icon-room air" ng-class="{\'off\': !room.air}"></div><div class="vl"></div><div class="icon icon-room person" ng-class="{\'off\': !room.person}"></div></div></div></div>'),e.put("app/components/AppShared/directives/preloader/preloader.html",'<div class="cssload-container"><div class="cssload-shaft1"></div><div class="cssload-shaft2"></div><div class="cssload-shaft3"></div><div class="cssload-shaft4"></div><div class="cssload-shaft5"></div><div class="cssload-shaft6"></div><div class="cssload-shaft7"></div><div class="cssload-shaft8"></div><div class="cssload-shaft9"></div><div class="cssload-shaft10"></div></div>'),e.put("app/components/AppShared/directives/room/room.html",'<div class="room" ng-class="room.type"><div class="wrapper light"><div class="icon icon-room light" ng-class="{\'off\': !room.light}"></div><span>维修中!</span><hr></div><div class="wrapper air"><div class="icon icon-room air" ng-class="{\'off\': !room.air}"></div><span>维修中!</span></div><div class="wrapper person"><div class="icon icon-room person" ng-class="{\'off\': !room.person}"></div><span>维修中!</span></div><div class="name">{{room.name}}</div></div>'),e.put("app/components/AppShared/directives/smiley-face/smiley-face.html",'<div class="smiley-face" ng-if="level"><div class="pulse" ng-class="level.level"></div></div>'),e.put("app/components/AppShared/directives/switchery/switchery.template.html",'<div class="switchery pull-right" ng-class="{\'on\':reverse?!on: on}" ng-click="switch()"><div class="selector"><div class="option">{{yesText}}</div><div class="option">{{noText}}</div></div><div class="slider"><div class="dile"></div><div class="dile"></div><div class="dile"></div></div></div>')}]);